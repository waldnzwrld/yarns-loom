# Interface

### Global control and display of the active part and its play mode
- Display periodically flashes the active part and its play mode
- Hold `START` to switch the active part (the new active part will flash briefly on the screen).  The active part is used for:
  - Selecting the recording part when pressing `REC`
  - Front-panel latching (hold `REC`)
  - Editing part-specific settings
- Hold/long-press `TAP` to switch the play mode for the active part (the new play mode will flash).  Play modes are:
  - **`M`anual**: Output is generated by the MIDI controller only
  - **`S`equencer**: Output is generated by the sequencer (and by the MIDI controller depending on `SI (SEQ INPUT RESPONSE)` -- see below)
  - **`A`rpeggiator**: Output is generated by the sequencer-driven arpeggiator (see below)

### Tap tempo changes
- If a single tap is received without follow-up, the tempo is set to use external clocking
- After setting a tempo, the result flashes on the screen

### Other changes
- Moved configuration-type settings into a submenu, accessed by opening `▽S (SETUP MENU)`
- Print flat notes as lowercase character (instead of denoting flatness with `b`) so that octave can always be displayed
- Improved clock-sync of display fade for the `TE(MPO)` setting
- Splash on save/load

# Synth voice

### Oscillator controls
- Configured via the `▽O (OSCILLATOR MENU)`
- `OM (OSCILLATOR MODE)` switches the oscillator between `OFF`, `DRONE`, and `ENVELOPED`
- `OS (OSCILLATOR SHAPE)` sets the waveform
  - White noise
  - Sharktooth
  - CS80 saw
  - Pulse
  - Hard-synced sine
  - Phase distortion, low-pass
  - Phase distortion, peaking
  - Phase distortion, band-pass
  - Phase distortion, high-pass
  - Folded triangle
  - Folded sine
  - Murmuring buzz
  - 55 FM ratios with fundamental frequency compensation, grouped by harmonic properties
- Each wave shape has a timbral parameter that can be modulated by several sources
  - `TI (TIMBRE INITIAL)` sets initial timbre
  - `TL (TIMBRE LFO MOD)` sets the depth of timbre modulation by the voice's bipolar LFO
  - `TE (TIMBRE ENV MOD)` sets the initial bipolar depth of modulation of timbre by envelope
  - `TV (TIMBRE VEL MOD)` sets the bipolar modulation by velocity of the envelope modulation of timbre (e.g. velocity can polarize the timbre envelope)

### Amplitude dynamics: ADSR envelopes (with velocity modulation) and tremolo
- Configured via the `▽A (AMPLITUDE MENU)`
- ADSR envelope with velocity modulation
  - Envelope controls voice amplitude when the `OSCILLATOR MODE` is `ENVELOPED`
  - Envelope is available as an assignable CV output (`ENVELOPE`) in all layouts
  - Peak attack amplitude can be velocity-scaled via `PV (PEAK MOD VEL)`
    - Positive values = damp on low velocity, negative values = damp on high velocity
  - The envelope's segments and their sensitivity to velocity are set by `ATTACK TIME INIT`, `ATTACK TIME MOD`, etc.
    - Segment times range from 1 ms (2 ticks) to 5 seconds
- Tremolo can be applied to envelope and oscillator
  - Tremolo uses the same LFO frequency as vibrato
  - `TR (TREMOLO DEPTH)` sets the amount of tremolo
  - `TS (TREMOLO SHAPE)` applies a waveshaper to the LFO (triangle, down saw, up saw, square)
  
# Sequencer

### Recording interface changes
- Hold `REC` to clear sequence
- First `REC` press switches the display to show the pitch instead of the step number (press again to exit recording)
- Flash note (or RS/TI) for the selected step
- Brighten display while the selected step is being played
- Wrap around around when using encoder to scroll through steps

### Looper-style sequencing mode with real-time recording
- To enable, ensure `SM (SEQ MODE)` is set to `LOOP`
- To use, press `REC` to enter real-time recording mode
  - Play notes to record them into the loop
  - Press `START` to delete the oldest note, or `TAP` for the newest
  - Scroll the encoder to shift the loop phase by 1/128: clockwise shifts notes earlier, counter-clockwise shits notes later
  - Hold `TAP` to toggle overwrite mode, which will clear the loop as soon as a new note is recorded
- Loop length is set by the `L- (LOOP LENGTH)` in quarter notes, combined with the part's clock settings
- Note start/end times are recorded at 13-bit resolution (1/8192 of the loop length)
- Holds 30 notes max -- past this limit, overwrites oldest note
- Step sequencer also reduced from 64 to 30 notes, to free up space in the preset storage

### Sequencer-driven arpeggiator
- Activated by setting the `ARP PATTERN` to `SEQUENCER`
- Arpeggiator is driven by looper/sequencer notes instead of by clock pulses -- a sequence must exist to produce arpeggiator output
- The arpeggiator respects rests/ties in the sequence
- The velocity of the arpeggiator output is the product of the velocities of the sequencer step and the held key
- New arpeggiator directions that use the note pitch as movement instructions:
  - Notes are interpreted based on key color (black/white) and distance above/below middle C
  - `ROTATE` treats white keys as relative movement through the chord, and black keys as offsets from the current position
  - `SUBROTATE` generates quasi-cartesian patterns

# MIDI

### Layouts
- `2+2` 3-part layout: one two-voice polyphonic part, two monophonic parts
- `2+1` 2-part layout: 2-voice polyphonic part, monophonic part with modulation output
- `*2` 3-part layout: 3-voice paraphonic part, 1 monophonic part with modulation, 1 monophonic part without modulation
  - Paraphonic part can use the new [envelopes](#adsr-envelopes-modulated-by-velocity)
  - Audio mode is always on for the paraphonic part
  - Output channels:
    1. Part 1, 3 voices mixed to 1 audio output
    2. Part 2, monophonic CV/gate
    3. Part 2, modulation configurable via `3>`
    4. Part 3, monophonic CV/gate
    
### Hold pedal
- Screen flashes the active part's hold status
  - Tick marks show the number of keys that are held, sustainable, sustained, and/or about to be released
  - Limited to the 6 most recent keys due to display size
- New `HM (HOLD PEDAL MODE)` setting to change the part's response to the hold pedal
  - `OFF` ignores the pedal
  - `SUSTAIN` is the stock firmware behavior (no notes are released as long as the pedal is down)
  - `SOSTENUTO` sustains only the notes held at the time the pedal goes down
  - `LATCH` uses the semantics of the front-panel latching in stock Yarns
  - `MOMENTARY LATCH` resembles `LATCH`, but releases latched notes as soon as the pedal is released, instead of on the next note
  - `CLUTCH` is a hybrid of `SOSTENUTO` and `LATCH` -- when the pedal goes down, sustains any held notes; while the pedal is up, pressing any note will release held notes
  - `FILTER` causes the part to only receive notes while the pedal is in a given state, and latches any notes that are "silently" released
- New `HP (HOLD PEDAL POLARITY)` setting to switch between [negative and positive pedal polarity](http://www.haydockmusic.com/reviews/sustain_pedal_polarity.html), or otherwise reverse pedal semantics

### Event routing, filtering, and transformation
- New `SI (SEQ INPUT RESPONSE)` setting changes how a playing sequence responds to manual input
  - `OFF` ignores keyboard input
  - `TRANSPOSE` is the stock firmware behavior
  - `REPLACE` retains the sequence's rhythm, but overrides its pitch
  - `DIRECT` gives full use of the keyboard, allowing accompaniment of a sequence, etc.
- New `IT (INPUT TRANSPOSE OCTAVES)` setting to apply transposition to notes received by a part
  - Effectively an octave switch for the controller
  - Ignored when using the step to control arpeggiator movement
- Parts can filter notes by velocity
  - Added UI for previously hidden settings `V> (VELOCITY MIN)` and `V< (VELOCITY MAX)`
  - Present for all layouts except 4V
  - Output velocity range is scaled to compensate for the restricted range imposed by input filtering
- Recording 
  - Any MIDI events ignored by the recording part can be received by other parts
  - Recording part now responds to MIDI start

### `VOICING` allocation methods
- New `NICE` option: voice-sticky like `POLY`, but without stealing
- Allow `POLY`/etc voice allocation methods to be played legato
- Fixed `UNISON` to respect `NOTE PRIORITY` and allocate notes without gaps; added new `FIRST` setting to `NOTE PRIORITY`
- Improve `UNISON`/`SORTED` to avoid unnecessary reassignment/retrigger of voices during a partial chord change
- `UNISON 2` and `SORTED` reassign voices on `NoteOff` if there are held notes that don't yet have a voice
  
### Expanded support for Control Change events
- The result of a received CC is briefly displayed
- Recording control: start/stop recording mode, delete a recording
- CC support for all new settings
- Fixed settings to accept a negative value via CC
- [Implementation Chart](https://docs.google.com/spreadsheets/d/1V6CRqf_3FGTrNIjcU1ixBtzRRwqjIa1PaiqOFgf6olE/edit#gid=0)

### Clock ratios
- Added a variety of integer ratios for `O/` and `C/` (and for clock-synced `VS (VIBRATO SPEED)`)
- [Includes 1/8, 3/7, 2/3, 6/5, 4/3, and more](./resources.cc#L755)
  
### Other tweaks
- Broadened portamento setting range from 51 to 64 values per curve shape
- Allow an explicit clock start (from panel switch or MIDI) to supersede an implicit clock start (from keyboard)
